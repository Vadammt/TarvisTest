language: android
sudo: false
android:
  components:
    # Uncomment the lines below if you want to
    # use the latest revision of Android SDK Tools
    - platform-tools
    - tools

    - build-tools-23.0.2
    - android-23

before_script:
  - echo no | android create avd --force -n test -t android-19 --abi armeabi-v7a
  - emulator -avd test -no-skin -no-audio -no-window &
  - android-wait-for-emulator
  - adb shell input keyevent 82 &

before_install:
  - echo yes | android update sdk --filter platform-tools --no-ui --force > /dev/null
  - echo yes | android update sdk --filter android-18 --no-ui --force > /dev/null
  - echo yes | android update sdk --filter sysimg-18 --no-ui --force > /dev/null
  - echo yes | android update sdk --filter extra-android-support --no-ui --force > /dev/null
  - echo yes | android update sdk --filter extra-android-m2repository --no-ui --force > /dev/null

# Following this: http://stackoverflow.com/a/28230711/1700776
before_deploy:
  - git config --global user.email "builds@travis-ci.com"
  - git config --global user.name "Travis CI"
  - export GIT_TAG=$TRAVIS_BRANCH-v0.1.$TRAVIS_BUILD_NUMBER
  - git tag $GIT_TAG -a -m "Generated tag from TravisCI for build $TRAVIS_BUILD_NUMBER"
  - export TAGPERM=pQC23emHybHkA9GRvinAnxyhAJ4dZKwuaBwbDaT2+drii2ZaqqFv6PAbgFKeyM6CTAXrwrkQi+TUOWPOaCtr8NnF09q9QDQf/5NWnReB6xE8Cq2bn5ZFKH6101vjWVvMYLt4UUFGfrRpWdlypAIrobt2UFABFSPCguqvdEZXeaPQf5TFSvCFXi9wguRbQEcQxV+1mUFFNLM8gHIW8S4E+I2roicGS+mLt02u6HNl8SX6EBT2X3BVHSPQJoiZQXVX9laladpuIdFzGuEcrvh8Y3IGBn4AqW0ZkvIp/JOREjfoKjxDGWNOKVjc/D3Eq9TB8OU3171Dqty4lUcosWibs8pd590pMxHcLOpybm4hsOh1xQQRzp+LEM2I5eT+nzlkPsG1mS6ctN+d8czj4KuXovrmwG206hrL2XrYiu5cLrdqiFl/xm7Ad7BrLcw9DQ8qlagHBQkBzty3/H7B1RhICD4aKFyr1YOP5YoggtSoBpRTr/UhUtM/4frhd+PN0H+6CcsRvudq+EasWCdXFUVUAwLew8wTFSs/PcGjqxUD2/WN6z0bJHTMIm3oUWU+QIbdNapQz27VEPhQ6Khqad8MSZ77GyaqfHu7s7sG21Zsn9iI4pZwjdNIRTjAqeX239Vs/fnNuNRbqG8viFAQ3lEr8+j8FVEZ2iB+RYBqh+Y/BLo=
  - git push -q https://$TAGPERM@github.com/Vadammt/TravisTest --tags

deploy:
  skip_cleanup: true
  provider: releases
  api_key:
    secure: pQC23emHybHkA9GRvinAnxyhAJ4dZKwuaBwbDaT2+drii2ZaqqFv6PAbgFKeyM6CTAXrwrkQi+TUOWPOaCtr8NnF09q9QDQf/5NWnReB6xE8Cq2bn5ZFKH6101vjWVvMYLt4UUFGfrRpWdlypAIrobt2UFABFSPCguqvdEZXeaPQf5TFSvCFXi9wguRbQEcQxV+1mUFFNLM8gHIW8S4E+I2roicGS+mLt02u6HNl8SX6EBT2X3BVHSPQJoiZQXVX9laladpuIdFzGuEcrvh8Y3IGBn4AqW0ZkvIp/JOREjfoKjxDGWNOKVjc/D3Eq9TB8OU3171Dqty4lUcosWibs8pd590pMxHcLOpybm4hsOh1xQQRzp+LEM2I5eT+nzlkPsG1mS6ctN+d8czj4KuXovrmwG206hrL2XrYiu5cLrdqiFl/xm7Ad7BrLcw9DQ8qlagHBQkBzty3/H7B1RhICD4aKFyr1YOP5YoggtSoBpRTr/UhUtM/4frhd+PN0H+6CcsRvudq+EasWCdXFUVUAwLew8wTFSs/PcGjqxUD2/WN6z0bJHTMIm3oUWU+QIbdNapQz27VEPhQ6Khqad8MSZ77GyaqfHu7s7sG21Zsn9iI4pZwjdNIRTjAqeX239Vs/fnNuNRbqG8viFAQ3lEr8+j8FVEZ2iB+RYBqh+Y/BLo=
  file: app\build\outputs\apk\app-release-unsigned.apk
  on:
    tags: false
    all_branches: true

branches:
  except:
    - /^*-v[0-9]/