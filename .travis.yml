language: android
sudo: false
android:
  components:
    # Uncomment the lines below if you want to
    # use the latest revision of Android SDK Tools
    - platform-tools
    - tools

    - build-tools-23.0.2
    - android-23

before_script:
  - echo no | android create avd --force -n test -t android-19 --abi armeabi-v7a
  - emulator -avd test -no-skin -no-audio -no-window &
  - android-wait-for-emulator
  - adb shell input keyevent 82 &

before_install:
  - echo yes | android update sdk --filter platform-tools --no-ui --force > /dev/null
  - echo yes | android update sdk --filter android-18 --no-ui --force > /dev/null
  - echo yes | android update sdk --filter sysimg-18 --no-ui --force > /dev/null
  - echo yes | android update sdk --filter extra-android-support --no-ui --force > /dev/null
  - echo yes | android update sdk --filter extra-android-m2repository --no-ui --force > /dev/null

# Now using this: https://github.com/Stevie-Ray/apache-nginx-referral-spam-blacklist/blob/master/.travis.yml
# Based on: http://stackoverflow.com/a/28230711/1700776
before_deploy:

  # rename apk
  - export OLD_APK=app/build/outputs/apk/app-release-unsigned.apk
  - export NEW_APK=app/build/outputs/apk/socko.apk
  - mv  $OLD_APK $NEW_APK
  # commit tags
  - git config --global user.email "builds@travis-ci.com"
  - git config --global user.name "Travis CI"
  - export GIT_TAG=$TRAVIS_BRANCH-0.1.$TRAVIS_BUILD_NUMBER
  - git tag $GIT_TAG -a -m "Generated tag from TravisCI for build $TRAVIS_BUILD_NUMBER"
  - git push -q https://${GH_TOKEN}@github.com/Vadammt/TravisTest --tags
  - ls -aR

deploy:
  provider: releases
  api_key:
    secure: ${GH_TOKEN}
  file: $NEW_APK
  skip_cleanup: true
  on:
    - build
    - tags: false

branches:
  except:
    # Ignore the Auto-tagged branches
    - /^*-v[0-9]/